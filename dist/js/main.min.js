console.log('js is ready');

const scenes = Array.from(document.querySelectorAll(".scene"));
const slides = Array.from(document.querySelectorAll('section.slide'));
const buttons = Array.from(document.querySelectorAll('.button'));
const equipmentGraphics = document.querySelector('.equipment .graphics');
const glass = equipmentGraphics.querySelector('.glass');
const suit = equipmentGraphics.querySelector('.suit');
const equipmentDarkFilter = equipmentGraphics.querySelector('.dark-filter');
const equipmentInfo = document.querySelector('.equipment .info');
const outside = document.querySelector('section.outside .background');
const outsideDarkFilter = document.querySelector('section.outside .dark-filter');
const outsideInfo = document.querySelector('section.outside .info');
const parallaxInstances = [];

console.log(slides);

//console.log(glass)

for (let i = 0; i < scenes.length; i++) {
  //parallaxInstance = new Parallax(scenes[i])
  parallaxInstances[i] = new Parallax(scenes[i]);
  if (i > 0) {
    parallaxInstances[i].disable();
  }
}

let currentSlideIndex = 0;

const nextSlide = () => {
  console.log('next');
  if (currentSlideIndex >= 0) {
    slides[currentSlideIndex].classList.remove('fadein');
    slides[currentSlideIndex].classList.add('fadeout');
    parallaxInstances[currentSlideIndex].disable();
  }
  if (currentSlideIndex < slides.length - 1) {
    currentSlideIndex++;
  }
  slides[currentSlideIndex].classList.add('fadein');
  //console.log(parallaxInstances)
  parallaxInstances[currentSlideIndex].enable();
  // Open suit protection
  if (currentSlideIndex == 2) {
    getSuit();
  } else if (currentSlideIndex == 3) {
    showRocket();
  }
};

const previousSlide = () => {
  if (currentSlideIndex == 2) {
    removeSuit();
  } else if (currentSlideIndex == 3) {
    outside.classList.remove("move");
  }
  if (currentSlideIndex > 0) {
    console.log('back');
    slides[currentSlideIndex].classList.remove('fadein');
    slides[currentSlideIndex].classList.add('fadeout');
    parallaxInstances[currentSlideIndex].disable();
    currentSlideIndex--;
    slides[currentSlideIndex].classList.remove('fadeout');
    slides[currentSlideIndex].classList.add('fadein');
    parallaxInstances[currentSlideIndex].enable();
  }
};

const getSuit = () => {
  window.setTimeout(() => {
    glass.classList.add("reveal");
  }, 2000);
  window.setTimeout(() => {
    suit.classList.add("expand");
  }, 4000);
  window.setTimeout(() => {
    equipmentGraphics.classList.add('travel');
    equipmentInfo.classList.add('reveal');
    equipmentDarkFilter.classList.add('visible');
  }, 5000);
};

const removeSuit = () => {
  glass.classList.remove("reveal");
  suit.classList.remove("expand");
  equipmentGraphics.classList.remove('travel');
  equipmentInfo.classList.remove('reveal');
  equipmentDarkFilter.classList.remove("visible");
};

const showRocket = () => {
  outside.classList.add('move');
  window.setTimeout(() => {
    outsideDarkFilter.classList.add('visible');
  }, 9000);
  window.setTimeout(() => {
    outsideInfo.classList.add('visible');
  }, 10000);
};

document.addEventListener('keydown', event => {
  switch (event.keyCode) {
    // Left arrow
    case 37:
      previousSlide();
      break;
    // Right arrow
    case 39:
      nextSlide();
      break;
    // Spacebar
    case 32:
      nextSlide();
      break;
  }
});

for (const button of buttons) {
  button.addEventListener('click', nextSlide);
}
const canvas = document.querySelector('.stars-bg');
const ctx = canvas.getContext('2d');
const centerPoint = {};
let stars = [];
let frameCount = 0;

const resize = () => {
  console.log('resize');
  // Resize canvas
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  centerPoint.x = canvas.width / 2, centerPoint.y = canvas.height / 2;

  // Reset canvas content
  clear();
  stars = [];
  for (let i = 0; i < 300; i++) {
    createStar();
  }
};

const createStar = () => {
  const star = {};
  star.x = canvas.width * Math.random();
  star.y = canvas.height * Math.random();
  star.distance = getDistance(star.x, star.y, centerPoint.x, centerPoint.y);
  star.random = Math.random();
  // Get angle between star and canvas center
  star.angle = Math.atan2(star.y - centerPoint.y, star.x - centerPoint.x);
  star.color = "#FFFDE7";
  star.radius = star.random * star.distance / 500;
  star.speed = Math.random() * 0.7;

  stars.push(star);
};

const moveStars = () => {
  let i = 0;
  for (const star of stars) {
    star.x += Math.cos(star.angle) * star.speed;
    star.y += Math.sin(star.angle) * star.speed;
    if (star.x < 0 || star.x > canvas.width || star.y < 0 || star.y > canvas.height) {
      // Delete elements out of canvas
      stars.splice(i, 1);
    }
    // Increase stars size when they get closer
    star.distance = getDistance(star.x, star.y, centerPoint.x, centerPoint.y);
    star.radius = star.random * star.distance / 500;
    i++;
  }
};

const draw = () => {
  for (const star of stars) {
    ctx.beginPath();
    ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
    ctx.fillStyle = star.color;
    ctx.fill();
  }
};

const clear = () => {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
};

const loop = () => {
  frameCount++;
  requestAnimationFrame(loop);

  // Create star every 20 frames
  if (frameCount % 20 == 0) {
    createStar();
  }
  moveStars();
  clear();
  draw();
};

const getDistance = (x0, y0, x1, y1) => {
  const differenceX = x0 - x1;
  const differenceY = y0 - y1;
  return Math.sqrt(Math.pow(differenceX, 2) + Math.pow(differenceY, 2));
};

resize();
loop();

window.addEventListener('resize', resize);